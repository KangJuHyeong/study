package opentest;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;

//jsoup
import org.jsoup.Jsoup;

//kkma
import org.snu.ids.kkma.index.Keyword;
import org.snu.ids.kkma.index.KeywordExtractor;
import org.snu.ids.kkma.index.KeywordList;
import org.w3c.dom.Document;
import org.w3c.dom.Element;


@SuppressWarnings({"rawtypes", "unchecked","nls"})
public class Main {

	public static void main(String[] args) throws IOException, TransformerException, ParserConfigurationException, ClassNotFoundException {
		// TODO Auto-generated method stub
		File file = new File("./data/떡.html");

		// 파싱
		org.jsoup.nodes.Document html = Jsoup.parse(file, "UTF8"); // ioexception,jsoup 임포트
		String titleData = html.title();
		String bodyData = html.body().text();
 
		
		//kkma
		KeywordExtractor ke = new KeywordExtractor();
		KeywordList k1 = ke.extractKeyword(bodyData, true);
		String x = "";
		for (int j = 0; j < k1.size(); j++) {
			Keyword kwrd = k1.get(j);
			x = x.concat(kwrd.getString() + ":" + kwrd.getCnt() + "#");

		}
		bodyData = x;

		
		// ParserConfigurationException document 작성
		DocumentBuilderFactory docFactory = DocumentBuilderFactory.newInstance();
		DocumentBuilder docBuilder = docFactory.newDocumentBuilder();
		Document doc = docBuilder.newDocument();

		Element movie = doc.createElement("docs"); // docs태그 생성
		doc.appendChild(movie);

		Element w = doc.createElement("doc"); // docs태그 안에 doc태그 생성
		movie.appendChild(w);

		w.setAttribute("id", Integer.toString(0)); // doc에 id값지정

		Element mn = doc.createElement("title"); // doc안에 title쓰기
		mn.appendChild(doc.createTextNode(titleData));
		w.appendChild(mn);

		Element mv = doc.createElement("body"); // doc안에 body쓰기
		mv.appendChild(doc.createTextNode(bodyData));
		w.appendChild(mv);

		
		// xml 파일로 쓰기
		TransformerFactory transformerFactory = TransformerFactory.newInstance(); // javax.xml.transform.TransformerFactory임포트
		Transformer transformer = transformerFactory.newTransformer(); // TransformerConfigurationException
		transformer.setOutputProperty(OutputKeys.ENCODING, "UTF-8");
		DOMSource source = new DOMSource(doc);
		StreamResult result = new StreamResult(new FileOutputStream(new File("./result/test.xml")));
		transformer.transform(source, result);
		
		
		
		
		
		
		
		
		
		//직렬화 post파일 저장
		String str="저장할 string";
		FileOutputStream fileStream = new FileOutputStream("./result/indexstr.post");
		ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileStream);
		objectOutputStream.writeObject(str);
		objectOutputStream.close();
		
		//역직렬화 post파일 읽기
		 FileInputStream FS=new FileInputStream("./result/indexstr.post");
	     ObjectInputStream obj= new ObjectInputStream(FS);
	     Object object=obj.readObject(); //classnotfoundexception
	     obj.close();
	     System.out.println("읽어온 객체의 type:"+object.getClass());
	     System.out.println(object);
	      

	}

}
